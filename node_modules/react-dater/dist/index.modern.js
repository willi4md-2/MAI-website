import e,{useContext as t,useRef as a,useEffect as r,Component as n,useState as o}from"react";import i from"prop-types";import s from"classnames";import l from"react-onclickoutside";import c from"date-fns/format";import d from"date-fns/startOfDay";import p from"date-fns/startOfWeek";import u from"date-fns/startOfMonth";import m from"date-fns/addDays";import f from"date-fns/addWeeks";import v from"date-fns/addMonths";import D from"date-fns/addYears";import h from"date-fns/subMonths";import y from"date-fns/subYears";import _ from"date-fns/setHours";import g from"date-fns/setMinutes";import w from"date-fns/parse";import S from"date-fns/parseISO";import E from"date-fns/toDate";import C from"date-fns/isValid";import x from"date-fns/getHours";import O from"date-fns/getMinutes";import T from"date-fns/getDate";import k from"date-fns/isSameDay";import b from"date-fns/isSameMonth";import N from"date-fns/isBefore";import R from"date-fns/differenceInCalendarYears";import M from"date-fns/differenceInCalendarMonths";import I from"date-fns/differenceInCalendarDays";import H from"date-fns/isWithinInterval";import F from"date-fns/endOfDay";import{enUS as V}from"date-fns/locale";import Y from"date-fns/addMinutes";import P from"@material-ui/icons/esm/CalendarToday";import B from"@material-ui/icons/esm/AccessTime";import{usePopper as L}from"react-popper";import{placements as W}from"@popperjs/core/lib/enums";function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function A(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var q=function(t){return e.createElement("div",{className:t.className},t.children)},X=function(){return"undefined"!=typeof window?window:global},U=function(e){var t=e?"string"==typeof e||e instanceof String?S(e):E(e):new Date;return C(t)?t:new Date},z=function(e,t,a){void 0===t&&(t="yyyy-MM-dd");var r=Q(a);return C(e)?c(e,t,{locale:r}):null},G=function(e,t,a){var r=Q(a),n=w(e,t,new Date,{locale:r});return C(n)?n:null},J=function(e,t){var a=Q(t);return p(e,{locale:a})},K=function(e,t){var a=X();a.__localeData__||(a.__localeData__={}),a.__localeData__[e]=t},Q=function(e){if(!e)return Z();if("string"==typeof e){var t=X();return t.__localeData__&&t.__localeData__[e]?t.__localeData__[e]:Z()}return e},Z=function(){return X().__default_locale__||V},$=function(e){X().__default_locale__=e},ee=function(e,t){var a=t.hour,r=void 0===a?0:a,n=t.min;return _(g(e,void 0===n?0:n),r)};function te(e,t){return I(e,t)>0?[t,e]:[e,t]}function ae(e,t,a){var r,n=te(t,a),o=n[0],i=n[1];try{r=H(e,{start:d(o),end:F(i)})}catch(e){r=!1}return r}var re=function(e,t){return!(!e||!t)&&k(e,t)},ne=e.createContext();function oe(t,a){return function(r){var n=a();return e.createElement(t,j({},n,r))}}var ie=e.memo(function(t){var a=t.day,r=t.viewed,n=t.hoveringDate,o=t.onDaySelect,i=t.onDayHover,l=t.startDate,c=t.endDate;return e.createElement("div",{className:s("rdx__day",{"rdx__day--selected":!t.selectDateRange&&re(a,t.selected),"rdx__day--range-start":!!l&&re(l,a),"rdx__day--range-end":!!c&&re(c,a),"rdx__day--in-range":function(){if(n){if(l&&!c)return ae(a,n,l);if(!l&&c)return ae(a,n,c)}else if(l&&c)return ae(a,l,c);return!1}(),"rdx__day--out-month":!b(a,r)}),onClick:function(e){o(a,e)},onMouseEnter:function(){i(a)}},T(a))});ie.propTypes={day:i.instanceOf(Date),viewed:i.instanceOf(Date),selected:i.instanceOf(Date),onDaySelect:i.func};var se=oe(ie,function(){var e=t(ne);return{minDate:e.minDate,selected:e.selected,viewed:e.viewed,hoveringDate:e.hoveringDate,onDaySelect:e.onDaySelect,onDayHover:e.onDayHover,startDate:e.startDate,endDate:e.endDate,selectDateRange:e.selectDateRange}}),le=[0,1,2,3,4,5,6],ce=function(t){return e.createElement("div",{className:"rdx__week"},function(t){var a=J(t);return[].concat(le.map(function(t){var r=m(a,t);return e.createElement(se,{key:t,day:r})}))}(t.day))};ce.propTypes={day:i.instanceOf(Date).isRequired};var de=function(t){return e.createElement("div",{className:"rdx__month"},function(t){var a,r=t.day,n=[],o=J(u(r));for(a=0;a<5;a++)n.push(e.createElement(ce,{weekNumber:a,key:"rdx-week-"+a,day:o})),o=f(o,1);return b(o,r)&&n.push(e.createElement(ce,{weekNumber:a,key:"rdx-week-"+a,day:o})),n}(t))};de.propTypes={day:i.instanceOf(Date).isRequired};var pe=e.memo(de,function(e,t){return!!b(e.day,t.day)});function ue(e,t){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}function me(e){if(!e)return 0;var t=parseInt(ue(e,"marginTop")),a=parseInt(ue(e,"marginBottom"));return e.clientHeight+t+a}var fe=oe(e.memo(function(t){var n=t.format,o=t.intervals,i=t.locale,l=t.onTimeSelect,c=t.setTimeLayerOpen,p=t.header,u=t.container,m=t.selected||U(),f=x(m),v=O(m),D=o||30,h=n||"HH:mm aa",y=a(),_=a();r(function(){var e=me(y.current),t=me(p.current);_.current.scrollTop=y.current.offsetTop-(u.current.clientHeight-t-e)/2},[y.current]);var g=function(e){l(e),c(!0)},w=function(e){return f===x(e)&&v===O(e)},S=function(e){return s("rdx__timeListItem",{"rdx__timeListItem--selected":w(e)})};return e.createElement("div",{ref:_,className:"rdx__timeDisplayWrapper"},function(){for(var t=[],a=d(m),r=1440/D,n=0;n<r;n++){var o=Y(a,n*D);t.push(o)}return t.map(function(t,a){return function(e){var t=v-O(e);return f===x(e)&&t<D&&t>=0}(t)?e.createElement("li",{key:a,onClick:function(){return g(t)},className:S(t),ref:y},z(t,h,i)):e.createElement("li",{key:a,onClick:function(){return g(t)},className:S(t)},z(t,h,i))})}())}),function(){var e=t(ne);return{locale:e.locale,selected:e.selected,onTimeSelect:e.onTimeSelect}}),ve={root:"rdx__timeToggleIcon"},De=function(t){function a(a){var r;return(r=t.call(this,a)||this).handleClickOutside=function(e){r.setState({timeCollapse:!0}),r.props.onClickOutside(e)},r.setTimeLayerOpen=function(e){r.setState({timeCollapse:e})},r.getDateInView=function(){var e=r.props;return e.viewed||e.selected||U()},r.decreaseMonth=function(){r.props.onChangeView(h(r.props.viewed,1))},r.increaseMonth=function(){r.props.onChangeView(v(r.props.viewed,1))},r.decreaseYear=function(){r.props.onChangeView(y(r.props.viewed,1))},r.increaseYear=function(){r.props.onChangeView(D(r.props.viewed,1))},r.renderCurrentMonthYear=function(t){void 0===t&&(t=r.getDateInView());var a=r.context.locale;return e.createElement("div",{className:s("rdx__current-headerInfo")},r.renderPreviousButton(),r.renderNextButton(),z(t,r.props.dateFormat,a))},r.renderCurrentMonthYearSparate=function(t){void 0===t&&(t=r.getDateInView());var a=r.context.locale;return e.createElement("div",{className:s("rdx__current-headerInfo")},e.createElement("div",{className:"rdx__month-info"},r.renderPreviousButton("MONTH"),r.renderNextButton("MONTH"),z(t,"LLL",a)),e.createElement("div",{className:"rdx__year-info"},r.renderPreviousButton("YEAR"),r.renderNextButton("YEAR"),z(t,"yyyy",a)))},r.renderWeekdayHeader=function(t){void 0===t&&(t=r.getDateInView());var a=r.context.locale,n=J(t,a),o=[];return o=o.concat([0,1,2,3,4,5,6].map(function(t){var r=function(e,t){return z(e,"EEEEEE",t)}(m(n,t),a);return e.createElement("div",{key:t,className:s("rdx__weekday-name")},r)})),e.createElement("div",{className:"rdx__weekdayname-header"},o)},r.renderDefaultHeader=function(t){var a=t.monthDate;return e.createElement("div",{className:"rdx__header rdx__header--default"},r.renderCurrentMonthYear(a),r.renderWeekdayHeader(a))},r.renderSeparateMonthYearHeader=function(t){var a=t.monthDate;return e.createElement("div",{className:"rdx__header rdx__header--separate"},r.renderCurrentMonthYearSparate(a),r.renderWeekdayHeader(a))},r.renderHeader=function(e){var t=e.monthDate;return r.props.showMonthYearSeparate?r.renderSeparateMonthYearHeader({monthDate:t}):r.renderDefaultHeader({monthDate:t})},r.renderMonths=function(){var t=r.getDateInView();return e.createElement("div",{className:"rdx__month-container",key:"month-0"},r.renderHeader({monthDate:t}),e.createElement(pe,{day:t}))},r.renderPreviousButton=function(t){void 0===t&&(t="MONTH");var a,n,o,i,l="NEXT "+t,c=!0;switch(t){case"MONTH":a=r.decreaseMonth,o=(void 0===(n=r.props)?{}:n).minDate,i=h(r.props.viewed,1),c=o&&M(o,i)>0;break;case"YEAR":a=r.decreaseYear,c=function(e,t){var a=(void 0===t?{}:t).minDate,r=y(e,1);return a&&R(a,r)>0}(r.props.viewed,r.props);break;default:a=function(){}}if(!c)return e.createElement("button",{type:"button",className:s("rdx__navigation","rdx__navigation--previous"),"aria-label":l,onClick:a},"PREVIOUS "+t)},r.renderNextButton=function(t){void 0===t&&(t="MONTH");var a,n,o,i,l="NEXT "+t,c=!0;switch(t){case"MONTH":a=r.increaseMonth,o=(void 0===(n=r.props)?{}:n).maxDate,i=v(r.props.viewed,1),c=o&&M(i,o)>0;break;case"YEAR":a=r.increaseYear,c=function(e,t){var a=(void 0===t?{}:t).maxDate,r=D(e,1);return a&&R(r,a)>0}(r.props.viewed,r.props);break;default:a=function(){}}if(!c)return e.createElement("button",{type:"button",className:s("rdx__navigation","rdx__navigation--next"),"aria-label":l,onClick:a},l)},r.renderFooter=function(){var t=r.state.timeCollapse;return e.createElement("div",{className:"rdx__time-footer","data-collapse":r.state.timeCollapse},e.createElement("div",{className:"rdx__timeToggleWrapper",onClick:function(){return r.setTimeLayerOpen(!t)},ref:r.headRef},e.createElement(t?B:P,{classes:ve})),e.createElement(fe,{header:r.headRef,container:r.containerRef,format:r.props.timeFormat,intervals:r.props.intervals,setTimeLayerOpen:r.setTimeLayerOpen}))},r.state={timeCollapse:!0},r.containerRef=e.createRef(),r.headRef=e.createRef(),r}return A(a,t),a.prototype.render=function(){return e.createElement("div",{ref:this.containerRef},e.createElement(q,{className:s("rdx",{"rdx--select-time":this.props.selectTime})},this.renderMonths(),this.props.children,this.props.selectTime&&this.renderFooter()))},a}(n);De.propTypes={intervals:i.number,dateFormat:i.string.isRequired,timeFormat:i.string,selected:i.instanceOf(Date),viewed:i.instanceOf(Date),showMonthYearSeparate:i.bool,selectTime:i.bool,selectDateRange:i.bool,selectTimeRange:i.bool,minDate:i.instanceOf(Date),maxDate:i.instanceOf(Date)},De.contextType=ne;var he=function(t){var a,r=t.hidePopper,n=t.popperComponent,i=t.popperPlacement,l=t.targetComponent,c=o(null),d=c[0],p=c[1],u=o(null),m=u[0],f=u[1],v=o(null),D=v[1],h=L(d,m,{modifiers:[{name:"arrow",options:{element:v[0]}},{name:"offset",options:{offset:[0,10]}}],placement:i}),y=h.styles,_=h.attributes;return a=e.createElement("div",j({className:s("rdx__popper"),ref:f,style:y.popper},_.popper,{"data-popper-reference-hidden":r}),e.cloneElement(n,{},e.createElement("div",{className:"rdx__arrow",ref:D}))),e.createElement(e.Fragment,null,e.createElement("div",{className:"rdx__display-wrapper",ref:p},l),a)};he.propTypes={hidePopper:i.bool,popperComponent:i.element,popperModifiers:i.object,popperPlacement:i.oneOf(W),popperContainer:i.func,popperProps:i.object,targetComponent:i.element},he.defaultProps={hidePopper:!1,popperProps:{},popperPlacement:"bottom-start"};var ye=l(De),_e=function(t){function a(a){var r;return(r=t.call(this,a)||this).getInitialState=function(){var e=r.props,t=e.minDate,a=e.maxDate,n=e.selectDateRange,o=e.startDate,i=e.endDate,s=e.selected||U(),l=o||null,c=i||null;return n&&(s=l||c||s),r.props.skipOverflowCheck||(t&&N(s,t)?s=t:a&&N(a,s)&&(s=a)),{open:!1,inputValue:null,focused:!1,selectState:l?1:c?2:0,selectedDate:s,viewDate:s,selectedDateStart:l,selectedDateEnd:c,hoveringDate:null}},r.getResetView=function(){if(r.props.selectDateRange){var e=r.state;return e.selectedDateStart||e.selectedDateEnd||e.viewDate}return r.state.selectedDate},r.clearTimer=function(){"number"==typeof r.inputTimeout&&(window.clearTimeout(r.inputTimeout),r.inputTimeout=null)},r.isCalendarOpen=function(){return r.state.open&&!r.props.disabled&&!r.props.readOnly},r.setOpen=function(e,t,a){r.setState(function(r){var n={open:e};return t?j(j({},n),{},{viewDate:a}):n})},r.setSelected=function(e,t,a){var n=r.state.selectedDate,o=e;r.props.selectTime&&a||(o=ee(o,{hour:x(n),min:O(n)})),r.setState({selectedDate:o,viewDate:o}),a||r.setState({inputValue:null}),r.props.onChange(o,t)},r.setRangeSelected=function(e,t,a){var n=void 0===e?{}:e,o=n.start,i=n.end,s={selectState:0,selectedDateStart:o||r.state.selectedDateStart,selectedDateEnd:i||r.state.selectedDateEnd};if(a){if(o&&i){var l=te(o,i);s.selectedDateStart=l[0],s.selectedDateEnd=l[1],s.inputValue=null}}else if(s.inputValue=null,0===r.state.selectState)s.selectState=1,null!==r.state.selectedDateStart&&(s.selectedDateEnd=null);else{var c=te(s.selectedDateStart,s.selectedDateEnd);s.selectedDateStart=c[0],s.selectedDateEnd=c[1],s.viewDate=s.selectedDateStart}0===s.selectState&&(s.hoveringDate=null),r.setState(s)},r.setViewDate=function(e){r.setState({viewDate:e})},r.handleInputClick=function(){r.props.disabled||r.props.readOnly||r.setOpen(!0)},r.handleFocus=function(e){},r.handleBlur=function(){},r.inputChangeCallBack=function(e){var t,a=r.props,n=a.dateFormatInput,o=a.locale,i=e.target.value;if(r.props.selectDateRange){var s=i.split("to").map(function(e){return e.trim()}),l=s[1],c=G(s[0],n,o),d=G(l,n,o);r.setRangeSelected({start:c,end:d},e,!0)}else(t=G(i,n,o))&&r.setSelected(t,e,!0)},r.handleInputChange=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var n=t[0].nativeEvent;r.clearTimer(),r.inputTimeout=window.setTimeout(r.inputChangeCallBack,2e3,n),r.setState({inputValue:n.target.value})},r.handleSelect=function(e,t){var a=r.state.selectState,n=r.props.selectDateRange;if(r.clearTimer(),n)switch(a){case 0:r.setRangeSelected({start:e},t,!1);break;case 1:r.setOpen(!1,!1),r.setRangeSelected({end:e},t,!1);break;case 2:r.setOpen(!1,!1),r.setRangeSelected({start:e},t,!1)}else r.setOpen(!1,!1),r.setSelected(e,t,!1)},r.handleDayHover=function(e){0!==r.state.selectState&&r.setState({hoveringDate:e})},r.handleTimeSelect=function(e){var t=ee(r.state.selectedDate,{hour:x(e),min:O(e)});r.setState({selectedDate:t,inputValue:null})},r.handleCalendarClickOutside=function(e){if(e.target!==r.input){var t;if(r.props.selectDateRange){var a=r.state;t=a.selectedDateStart||a.selectedDateEnd||a.viewDate}else t=r.state.selectedDate;r.setOpen(!1,!0,t)}},r.getDateRangeFormat=function(){var e=r.props,t=e.dateFormatInput,a=e.locale,n=r.state,o=n.selectedDateEnd;return(z(n.selectedDateStart,t,a)||"...")+" to "+(z(o,t,a)||"...")},r.renderCalendar=function(){return e.createElement(ye,{intervals:r.props.intervals,dateFormat:r.props.dateFormatCalendar,onClickOutside:r.handleCalendarClickOutside,selected:r.state.selectedDate,viewed:r.state.viewDate,onChangeView:r.setViewDate,showMonthYearSeparate:r.props.showMonthYearSeparate,selectTime:r.props.selectTime,selectDateRange:r.props.selectDateRange,selectTimeRange:r.props.selectTimeRange,minDate:r.props.minDate,maxDate:r.props.maxDate})},r.renderDateInput=function(){var t=r.props.inputElement||e.createElement("input",{type:"text"}),a="string"==typeof r.state.inputValue?r.state.inputValue:r.props.selectDateRange?r.getDateRangeFormat():z(r.state.selectedDate,r.props.dateFormatInput,r.props.locale),n=s("rdx__textInput",r.props.customClassName,t.props.className);return e.cloneElement(t,{ref:function(e){return r.input=e},value:a,onChange:r.handleInputChange,onFocus:r.handleFocus,onBlur:r.handleBlur,onClick:r.handleInputClick,placeholder:r.props.placeholderText,readOnly:r.props.readOnly,disabled:r.props.disabled,className:n})},r.state=r.getInitialState(),r.inputTimeout=null,r}return A(a,t),a.prototype.render=function(){var t=this.renderCalendar(),a=this.state;return e.createElement(ne.Provider,{value:{selectDateRange:this.props.selectDateRange,locale:this.props.locale,selected:a.selectedDate,viewed:a.viewDate,hoveringDate:a.hoveringDate,startDate:a.selectedDateStart,endDate:a.selectedDateEnd,minDate:this.props.minDate,onDaySelect:this.handleSelect,onDayHover:this.handleDayHover,onTimeSelect:this.handleTimeSelect}},e.createElement(he,{hidePopper:!this.isCalendarOpen(),popperComponent:t,targetComponent:e.createElement("div",{className:"rdx__input-container"},this.renderDateInput())}))},a}(e.Component);_e.propTypes={customClassName:i.string,intervals:i.number,dateFormatCalendar:i.string,dateFormatInput:i.string,dateFormatTime:i.string,locale:i.oneOfType([i.string,i.object]),disabled:i.bool,readOnly:i.bool,inputElement:i.element,onChange:i.func,selected:i.instanceOf(Date),showMonthYearSeparate:i.bool,selectTime:i.bool,selectDateRange:i.bool,selectTimeRange:i.bool,minDate:i.instanceOf(Date),maxDate:i.instanceOf(Date),startDate:i.instanceOf(Date),endDate:i.instanceOf(Date),skipOverflowCheck:i.bool},_e.defaultProps={dateFormatCalendar:"LLL yyyy",dateFormatInput:"MM/dd/yyyy",dateFormatTime:"HH:mm",onChange:function(){},skipOverflowCheck:!1};export default _e;export{K as addLocale,$ as registerDefaultLocale};
